---
title: "End results"
author: "Vegard Nygaard"
---

`r as.character(Sys.time())`
<br/>
<br/>

Agreement between our two approaches called **merged** and **meta**.
Agreement between our results and Volinia.
Checking all results toward a list of verified microRNAs.

<BR/>
<BR/>
## Meta vs Merged results.

Our data sets came from two providers, "AHUS" and "UCAM", using two different Agilent microRNA platforms. Batch effects were present as visualized in the QC report. We tested for differentially expressed genes using two approaches, combining all data in Limma using provider as a blocking factor ("merged" approach), and analyzing the two sets inependetly with Limma and combine the p-values ("meta" approach).

Here we will list the agreemet between the two apporaches.


```{r}

metafilefolder = "not_in_github/t-test"
mergedfilefolder = "output-analysis"
#metaresultfiles = list.files("lilianas/1000_permutations")
#mergedresultfiles = list.files("output-analysis-2014-08-05", pattern="difflist")

comparisons = c("DCIS-normal", "invasive-DCIS", "Normallike-DCIS", "LumA-DCIS", "LumB-DCIS", "Her2-DCIS", "Basallike-DCIS")

meta2merged = data.frame(metafn=character(0), mergedfn=character(0), direction=numeric(0), stringsAsFactors=FALSE)
meta2merged["DCIS-normal",] = list("DCIS_to_normal_test", "difflist-DCIS-vs-normal.txt",-1)
meta2merged["invasive-DCIS",] = list("DCIS_to_invasive_test", "difflist-invasive-vs-DCIS.txt",1)
meta2merged["Normallike-DCIS",] = list("DCIS_to_normal(invasive)_test", "difflist-pam50-Normallike-vs-DCIS.txt",1)
meta2merged["LumA-DCIS",] = list("DCIS_to_lumA_test", "difflist-pam50-LumA-vs-DCIS.txt",1)
meta2merged["LumB-DCIS",] = list("DCIS_to_lumB_test", "difflist-pam50-LumB-vs-DCIS.txt",1)
meta2merged["Her2-DCIS",] = list("DCIS_to_Her2_test", "difflist-pam50-Her2-vs-DCIS.txt",1)
meta2merged["Basallike-DCIS",] = list("basal_to_DCIS_test", "difflist-pam50-Basallike-vs-DCIS.txt",-1)

metatables = list()
mergedtables = list()
summarytab = data.frame( found_meta=integer(0),  found_merged=integer(0), 
                       found_both=integer(0),  stringsAsFactors=FALSE)

for(i in 1:nrow(meta2merged))
{   
    thiscomp = rownames(meta2merged)[i]
    fn = paste(metafilefolder, "/", meta2merged[thiscomp, "metafn"], sep="")
    thismetatab = read.table(fn, sep="\t", header=TRUE, stringsAsFactors=FALSE, fill=TRUE,
                                     strip.white=TRUE, comment.char ="")
    fn = paste(mergedfilefolder, "/", meta2merged[thiscomp, "mergedfn"], sep="")
    thismergedtab = read.table(fn, sep="\t", header=TRUE, stringsAsFactors=FALSE, fill=TRUE,
                                     strip.white=TRUE, comment.char ="", row.names=1)
    
    #harmonizing
    colnames(thismetatab)[colnames(thismetatab)=="FC"] = "logFC"
    rownames(thismetatab) = thismetatab$MIMAT
    thismetatab$logFC = thismetatab$logFC * meta2merged[thiscomp, "direction"]
  #summarytab[thiscomp, "metafile"] = rownames(thisrows)[1]
  #summarytab[thiscomp, "mergedfile"] = thisrows[1, "mergedfn"]

  summarytab[thiscomp, "found_meta"] = nrow(thismetatab)
  b = thismergedtab$adj.P.Val <= 0.05
  summarytab[thiscomp, "found_merged"] = sum(b)
  
  commonMIMATID = intersect( rownames(thismetatab),  rownames(thismergedtab)[b])
  summarytab[thiscomp, "found_both"] = sum( thismetatab[commonMIMATID, "logFC"] * thismergedtab[commonMIMATID, "logFC"] > 0) 
  rm(commonMIMATID)
  metatables[[thiscomp]] = thismetatab
  mergedtables[[thiscomp]] = thismergedtab
}

```
<br/>
<br/>
<br/>
The number of microRNAs found differentially expressed between states, according to the two approaches. The direction of foldchange is taken into acount. 
```{r}
print(summarytab[,1:3])
```
For several of the comparisons, the shorter list seems to be mostly included in the longer.
<br/>
<br/>


## Our results vs. Volinia et al.Â´s results



